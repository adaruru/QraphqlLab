# GraphQL Lab Configuration - Detailed Example with Explanations
#
# 本檔案詳細說明為什麼某些配置放在這裡，某些放在 .env 檔案中
#
# ============================================================================
# 配置管理哲學：
# ============================================================================
#
# 1. 配置檔案 (此檔案) 適合：
#    - 業務邏輯相關的設定
#    - 不常變動的參數
#    - 所有環境通用的設定
#    - 可以公開的配置
#
# 2. 環境變數 (.env) 適合：
#    - 敏感資訊（密碼、金鑰）
#    - 環境特定值（主機名、Port）
#    - 經常變動的參數
#    - 不應提交到版本控制的資訊
#
# ============================================================================

# ----------------------------------------------------------------------------
# 資料庫配置
# ----------------------------------------------------------------------------
database:
  # 連線資訊 - 這些應該從環境變數讀取
  # 為什麼？因為每個環境（dev/sit/uat/prod）都不同
  #
  # 實際使用時，程式會從環境變數讀取：
  #   host: ${DB_HOST}           # 從環境變數讀取
  #   port: ${DB_PORT}           # 從環境變數讀取
  #   user: ${DB_USER}           # 從環境變數讀取
  #   password: ${DB_PASSWORD}   # 從環境變數讀取（敏感！）
  #   name: ${DB_NAME}           # 從環境變數讀取
  #
  # 這裡的值僅作為參考或預設值
  host: localhost              # 預設值，實際由 DB_HOST 環境變數決定
  port: 3306                   # 預設值，實際由 DB_PORT 環境變數決定
  user: root                   # 預設值，實際由 DB_USER 環境變數決定
  password: ""                 # 永遠從 DB_PASSWORD 環境變數讀取
  name: graphqllab             # 預設值，實際由 DB_NAME 環境變數決定

  # 連線池設定 - 這些適合放在配置檔案中
  # 為什麼？因為這些是程式邏輯相關的參數，通常所有環境使用相同值
  charset: utf8mb4             # 固定設定，所有環境相同
  max_open_connections: 25     # 業務邏輯設定，可能會調整但不頻繁
  max_idle_connections: 5      # 業務邏輯設定
  connection_max_lifetime: 5m  # 業務邏輯設定

  # 查詢設定
  timeout: 30s                 # 查詢超時時間
  slow_query_threshold: 200ms  # 慢查詢閾值

# ----------------------------------------------------------------------------
# 伺服器配置
# ----------------------------------------------------------------------------
server:
  # Port 和 Host - 應該從環境變數讀取
  # 為什麼？因為不同環境使用不同的 port 避免衝突
  #
  # 實際使用：
  #   port: ${SERVER_PORT}
  #   host: ${SERVER_HOST}
  #
  port: 8080                   # 預設值，實際由 SERVER_PORT 環境變數決定
  host: "0.0.0.0"              # 預設值，可由 SERVER_HOST 環境變數覆蓋

  # 運行模式 - 通常從環境變數讀取
  # 為什麼？因為 dev 用 debug，prod 用 release
  #
  # 實際使用：mode: ${GIN_MODE}
  mode: debug                  # debug 或 release，由 GIN_MODE 環境變數決定

  # 伺服器參數 - 適合放在配置檔案
  # 為什麼？這些是程式邏輯相關，通常不會因環境而異
  read_timeout: 15s            # HTTP 讀取超時
  write_timeout: 15s           # HTTP 寫入超時
  idle_timeout: 60s            # Keep-alive 超時
  max_header_bytes: 1048576    # 最大 header 大小 (1MB)

  # CORS 設定 - 可能會因環境而異，但不是敏感資訊
  # 建議：在配置檔案中設定預設值，可透過環境變數覆蓋
  cors:
    allowed_origins:
      - "http://localhost:3000"
      - "http://localhost:8080"
    allowed_methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    allowed_headers:
      - Content-Type
      - Authorization
    max_age: 3600

# ----------------------------------------------------------------------------
# 日誌配置
# ----------------------------------------------------------------------------
logging:
  # 日誌等級 - 應該從環境變數讀取
  # 為什麼？dev 用 debug，prod 用 warning，需要快速切換
  #
  # 實際使用：level: ${LOG_LEVEL}
  level: debug                 # 預設值，實際由 LOG_LEVEL 環境變數決定

  # 日誌格式 - 適合放在配置檔案
  # 為什麼？這是程式邏輯相關的設定，通常固定為 json
  format: json                 # json 或 text

  # 日誌輸出 - 適合放在配置檔案
  output:
    - stdout                   # 標準輸出（Docker 友善）
    # - file                   # 也可以輸出到檔案

  # 檔案日誌設定（如果啟用 file 輸出）
  file:
    path: /var/log/graphqllab
    max_size: 100              # MB
    max_backups: 3
    max_age: 7                 # 天
    compress: true

# ----------------------------------------------------------------------------
# GraphQL 配置
# ----------------------------------------------------------------------------
graphql:
  # GraphQL 端點 - 固定設定
  endpoint: /graphql
  playground: /playground

  # Playground 啟用 - 可能因環境而異
  # dev/sit: 啟用，prod: 停用
  # 建議：使用環境變數控制
  playground_enabled: true     # 實際由 GRAPHQL_PLAYGROUND_ENABLED 決定

  # 查詢複雜度限制 - 業務邏輯設定
  query_complexity:
    max_depth: 10              # 最大巢狀深度
    max_complexity: 1000       # 最大查詢複雜度

  # 效能設定
  enable_introspection: true   # 是否允許 introspection（prod 建議關閉）
  enable_tracing: false        # 是否啟用追蹤

# ----------------------------------------------------------------------------
# Redis 配置（如果使用）
# ----------------------------------------------------------------------------
redis:
  # 連線資訊 - 應該從環境變數讀取
  # 為什麼？每個環境的 Redis 主機不同
  #
  # 實際使用：
  #   host: ${REDIS_HOST}
  #   password: ${REDIS_PASSWORD}  # 敏感資訊！
  #
  host: localhost              # 預設值，實際由 REDIS_HOST 決定
  port: 6379
  password: ""                 # 從 REDIS_PASSWORD 環境變數讀取
  db: 0

  # 連線池設定 - 業務邏輯設定
  pool_size: 10
  min_idle_connections: 5
  max_retries: 3
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

# ----------------------------------------------------------------------------
# 快取配置
# ----------------------------------------------------------------------------
cache:
  # 快取策略 - 業務邏輯設定
  default_ttl: 3600            # 秒（1小時）
  max_entries: 10000           # 最大快取項目數

  # 不同資料類型的 TTL
  ttl:
    user: 1800                 # 30分鐘
    product: 3600              # 1小時
    static: 86400              # 24小時

# ----------------------------------------------------------------------------
# 速率限制
# ----------------------------------------------------------------------------
rate_limit:
  # 速率限制設定 - 業務邏輯設定
  # 為什麼放這裡？這是業務規則，通常所有環境相同
  enabled: true
  requests_per_minute: 100
  burst: 20

  # 不同端點的限制
  endpoints:
    "/api/users":
      requests_per_minute: 50
    "/graphql":
      requests_per_minute: 100

# ----------------------------------------------------------------------------
# 安全性配置
# ----------------------------------------------------------------------------
security:
  # JWT 配置
  jwt:
    # Secret - 絕對不能寫在這裡！必須用環境變數
    # secret: ${JWT_SECRET}    # 從環境變數讀取

    # JWT 參數 - 業務邏輯設定
    expiration: 24h            # Token 有效期
    refresh_expiration: 168h   # Refresh token 有效期（7天）
    issuer: "graphqllab"

  # 密碼策略 - 業務規則
  password:
    min_length: 8
    require_uppercase: true
    require_lowercase: true
    require_number: true
    require_special: false

# ----------------------------------------------------------------------------
# 功能開關（Feature Flags）
# ----------------------------------------------------------------------------
features:
  # 功能開關 - 適合放在配置檔案
  # 為什麼？這些是業務邏輯控制，需要版本控制
  enable_graphql: true
  enable_rest: true
  enable_websocket: false
  enable_grpc: false

  # 實驗性功能
  experimental:
    new_query_engine: false
    enhanced_caching: false

# ----------------------------------------------------------------------------
# 監控與追蹤
# ----------------------------------------------------------------------------
monitoring:
  # Metrics 端點
  metrics_endpoint: /metrics
  metrics_enabled: true

  # 健康檢查
  health_endpoint: /health
  readiness_endpoint: /ready

  # OpenTelemetry（如果使用）
  tracing:
    enabled: false
    endpoint: ""               # 實際由 OTEL_ENDPOINT 環境變數決定
    sample_rate: 0.1           # 10% 採樣率

# ============================================================================
# 環境變數對照表
# ============================================================================
#
# 以下是應該在 .env 檔案中設定的環境變數：
#
# 資料庫相關：
#   DB_HOST=localhost           # 資料庫主機
#   DB_PORT=3306                # 資料庫 Port
#   DB_USER=root                # 資料庫使用者
#   DB_PASSWORD=secret          # 資料庫密碼（敏感！）
#   DB_NAME=graphqllab          # 資料庫名稱
#
# 伺服器相關：
#   SERVER_PORT=8080            # API Port
#   SERVER_HOST=0.0.0.0         # 監聽位址
#   GIN_MODE=debug              # Gin 模式（debug/release）
#
# 日誌相關：
#   LOG_LEVEL=debug             # 日誌等級
#
# Redis 相關（如果使用）：
#   REDIS_HOST=localhost        # Redis 主機
#   REDIS_PASSWORD=secret       # Redis 密碼（敏感！）
#
# 安全相關：
#   JWT_SECRET=your-secret-key  # JWT 金鑰（敏感！）
#
# 功能開關（可選，覆蓋配置檔案）：
#   GRAPHQL_PLAYGROUND_ENABLED=true
#
# 環境識別：
#   ENVIRONMENT=development     # 環境名稱（dev/sit/uat/prod）
#
# ============================================================================
# 配置優先順序
# ============================================================================
#
# 1. 環境變數（最高優先）
# 2. .env 檔案
# 3. 本配置檔案（config.yaml）
# 4. 程式碼預設值（最低優先）
#
# 範例：決定資料庫主機的邏輯
#   if os.Getenv("DB_HOST") != "" {
#       host = os.Getenv("DB_HOST")           // 環境變數
#   } else if envFile["DB_HOST"] != "" {
#       host = envFile["DB_HOST"]             // .env 檔案
#   } else if config.Database.Host != "" {
#       host = config.Database.Host           // config.yaml
#   } else {
#       host = "localhost"                    // 預設值
#   }
#
# ============================================================================
